<app-header *ngIf="!isLoginPage()"></app-header>
<router-outlet></router-outlet>
<div class="bottom-button-container" *ngIf="!isLoginPage()">
  <button class="review-product-btn" (click)="openReviewForm()">Review Product</button>
</div>
<div class="floating-chatbot-btn" (click)="toggleChatbotModal()">
  <svg class="gemini-icon" viewBox="0 0 24 24" fill="currentColor">
    <path d="M12 2L13.09 8.26L19 9L13.09 9.74L12 16L10.91 9.74L5 9L10.91 8.26L12 2Z"/>
    <path d="M19 15L19.83 18.83L23 19L19.83 19.17L19 23L18.17 19.17L15 19L18.17 18.83L19 15Z"/>
    <path d="M8 7L8.5 9.5L11 10L8.5 10.5L8 13L7.5 10.5L5 10L7.5 9.5L8 7Z"/>
  </svg>
</div>

<!-- Chatbot Modal -->
<div class="chatbot-modal-overlay" *ngIf="showChatbotModal" (click)="closeChatbotModal()">
  <div class="chatbot-modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-top">
        <h3>Gemini AI Assistant</h3>
        <button class="close-btn" (click)="closeChatbotModal()">Ã—</button>
      </div>
      <!-- Product Selector -->
      <div class="product-selector">
        <label>Select Product (Optional):</label>
        <div class="selector-row">
          <select 
            [(ngModel)]="selectedProductForChat" 
            (change)="selectProductForChat(selectedProductForChat || '')"
            class="product-dropdown">
            <option [value]="undefined">General Questions</option>
            <option *ngFor="let product of availableProducts" [value]="product">
              {{ product }}
            </option>
          </select>
          <button 
            *ngIf="selectedProductForChat" 
            class="clear-selection-btn"
            (click)="clearProductSelection()">
            Clear
          </button>
        </div>
        <div class="selected-product" *ngIf="selectedProductForChat">
          <strong>Currently asking about:</strong> {{ selectedProductForChat }}
        </div>
      </div>
    </div>
    <div class="modal-body">
      <app-chatbot 
        [showHeader]="false" 
        [contextProduct]="selectedProductForChat">
      </app-chatbot>
    </div>
  </div>
</div>